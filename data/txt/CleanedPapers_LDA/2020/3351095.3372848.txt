Multi-Category Fairness in Sponsored Search Auctions Fairness in advertising is a topic of particular concern motivated by theoretical and empirical observations in both the computer science and economics literature We examine the problem of fairness in advertising for general purpose platforms that service advertisers from many different categories First we propose inter-category and intra-category fairness desiderata that take inspiration from individual fairness and envy-freeness Second we investigate the platform utility a proxy for the quality of allocation achievable by mechanisms satisfying these desiderata More specifically we compare the utility of fair mechanisms against the unfair optimum and show by construction that our fairness desiderata are compatible with utility Our mechanisms also enjoy nice implementation properties including metric-obliviousness which allows the platform to produce fair allocations without needing to know the specifics of the fairness requirements CONCEPTS Theory of Computation Algorithmic Mechanism Design KEYWORDS algorithmic fairness advertisement auctions utility individual fairness envy-freeness INTRODUCTION In the ongoing discussion of what it means for automated decisionmaking systems to be fair the topic of online advertising has merited particular interest In the United States segregated employment ads for men and women proved to be a flashpoint in the s and the introduction of ever-more finely-tuned advertising online has renewed concerns about discrimination in ads for critical categories such as employment housing and credit Although individual advertisers certainly have opportunities to use fine-grained targeting in some cases targeting individual users to implement biased advertising strategies there is both empirical evidence and theoretical support for the idea that skewed advertisement between different demographic groups is not solely due to biased advertiser behavior Indeed recent work has shown that even when the advertisers all act fairly in isolation revenue-optimized platform mechanisms can result in unfairness In particular even when each advertiser intends to be fair in its delivery competition between advertisers in first-price auctions particularly across categories can introduce a significant skew in the types of ads people see eg For example two software engineers who are targeted equally by software engineering companies may see wildly different numbers of employment ads depending on competition for their attention from other categories Competition from lucrative categories like childrens products can be difficult for an individual advertiser to correct for particularly in categories like employment where parental status is considered very sensitive While the idea of parents being excluded from employment ads due to competition is troubling blunt policies like equalizing the number of ads across users within each category can also result in poor outcomes for individuals For example suppose Bob is highly qualified for a new credit card and he is also searching for daycare options in his area Alice is equally qualified for the credit card but she is not interested in daycare Bob would not want to see fewer ads for daycare services to ensure that he sees as many ads for credit as Alice and likewise Alice would not want good credit offers suppressed in order to ensure that she doesnt see more credit ads than Bob who doesnt care as much about credit cards anyway Competition between ads within a single category can also result in undesirable skew Even if two equally qualified individuals see the same number of ads in a category these ads may not be equally relevant or valuable to them For example these individuals could see the same total number of job ads but with one receiving ads for jobs with significantly higher salaries than the other they compatible with consumer platform and advertiser utility Our Contributions Model and Definitions In this work we examine the problem of fairness in advertising across multiple categories from a theoretical perspective We propose a stylized model and fairness requirements that match the intuitive fairness desiderata of inter- and intra-category guarantees incorporate the qualifications of users as well as their preferences across different ad categories Our definitions are inspired by and combine the complementary notions of envy-freeness and individual fairness Envy-freeness requires that every user should prefer their own allocation to that of everyone else it ignores users may also significantly influence the usefulness of the ads to each user notions of fairness interact with platform utility as well as our intuition about what is fair rather than to propose a specific notion of fairness for practical implementation qualifications and considers preferences as paramount Individual or metric fairness on the other hand ignores preferences and essentially requires that similar users should be treated similarly Its extension to multi-dimensional allocations as introduced in multiple task fairness requires that individual fairness is satisfied separately and simultaneously for all categories For inter-category competition we note that multiple task fairness is at odds with consumer and platform utility Consider the example of Alice and Bob discussed above Taking this example to the extreme suppose that a user whom we will call Jack is a jack of all trades ie qualified or interested in many categories Per multiple task fairness another user who is as qualified as Jack in a single category but unqualified in all other categories would have their allocation within the single category of interest limited to match Jacks allocation within that category Multiple task fairness would then either enforce a minimum amount of exposure for Jack to ads they may not care about or dictate a maximum amount of exposure to relevant ads for other users who are qualified for a smaller number of categories In effect by ignoring users own preferences this stringent notion of fairness helps no one We thus introduce inter-category envy-freeness which allows users to specify a set of categories that they care about and guarantees that they see at least as many ads that they care about as any other individual ness can be too weak to avoid discriminatory allocations and is therefore vulnerable to certain subversion attacks For example if Alice sees every high-paying job ad slightly less often than Bob and every low-paying job ad slightly more often than Bob then for any single ad the two users obtain similar allocations but across the set of all high-paying jobs Alice may receive a far smaller share than Bob We thus introduce total variation fairness which offers protection against these subversion attacks and captures fairness over all possible sets of substitutes both across categories and within categories More specifically we demonstrate how to combine inter-category envy-freeness and total-variation fairness into a hybrid fairness notion that we call compositional fairness For example suppose two individuals Alice and Bob are equally qualified and interested in a particular type of job Alice is also interested in the latest movie releases while Bob is interested in buying a new car We provide the guarantee that Alice and Bob see the same mix of ads for jobs but are permitted to see job ads overall with different probabilities so long as each sees their preferred categories in total at least as often as the other Mechanism design with fairness constraints In practice fairness is obviously not the only consideration in mechanism design Platforms typically aim to optimize for short-term revenue ie the sum of payments made by advertisers for displaying their ads or allocative efficiency aka social welfare ie the sum of the perceived values of the user-ad matches or a combination of these user-preferences and individual fairness setting there are many subtle properties which may be harder to articulate eg commute time By protecting all sets of substitutes we obviate the need to enumerate all possible attributes objectives As a proxy for these complex objectives we use the sum of the bids of the ads displayed as a measure of the quality of an allocation We call this objective platform utility High platform utility correlates both with advertiser happiness ads get matched with targeted high bid users as well as with platform revenue advertisers often pay their bid or an increasing function of their bid While our goal is to design fair mechanisms that achieve high platform utility we compare the performance of our mechanisms to the unfair optimum following the intuition that platforms and advertisers are unlikely to adopt mechanisms which deviate wildly in utility from the status quo In this respect we show that our fairness desiderata are compatible with high platform utility Apart from these fairness and utility objectives from a mechanism design perspective it is desirable for our mechanisms to satisfy certain implementation properties The first question that needs to be addressed is how to distribute the responsibility for ensuring fairness among the advertisers and the platform In this work we give a clear separation of responsibilities the advertisers are required to bid fairly and the platform is required to fairly allocate advertisements assuming the bids are fair any perceived unfairness can be clearly tracked to the responsible party Moreover we propose that the determination of what constitutes fairness in each category and auditing of advertiser bids be outsourced to a neutral third-party or governing body so that the platform can be oblivious to the particulars of fairness requirements encoded into the bids when the advertisers are required to satisfy fair bidding constraints Allocation algorithms achieving high utility In this work we take a first step towards designing fair auction mechanisms for ad platforms We focus on constructing fair allocation algorithms where the allocation is fair so long as the bids are fair and that achieve a high platform utility In particular we do not consider incentives Nonetheless our allocation algorithms already achieve some of the nice properties that are needed for incentive compatibility like monotonicity and individual rationality though a full consideration of incentives would require considering how advertisers behave when their true values are not fair Our main result is a family of allocation algorithms that achieve compositional fairness and utility close to optimal within the class of fair algorithms while also being oblivious to fairness requirements The nature of the fairness definitions enables us to compose an algorithm satisfying total-variation fairness within each category with an algorithm satisfying inter-category envy-freeness across categories to obtain a algorithm satisfying compositional fairness Thus we can separately design inter- and intra-category algorithms platform to achieve fairness potentially by changing advertiser bids However this would make it impossible for the platform to be oblivious to fairness requirements and could also cause transparency issues in the bidding process Moreover the advertiser is generally in a better position than the platform to understand the nuances of fairness in their particular category For example a car insurance advertiser is more likely to be aware of the problems associated with using zip code to determine insurance rates than the advertising platform which may have advertisers from thousands of different categories For this reason we argue for a separation where the advertisers are required to bid fairly and the platform is allowed to assume bids are fair or sensitive information may be leaked by the determination procedure it may be desirable to avoid sharing this information with the platform The inter-category algorithms that we propose are always envy-free regardless of the bids and the intra-category algorithms that we propose are oblivious to fairness requirements our intra-category algorithm implicitly uses fairness of advertiser bids to infer and provide the necessary fairness requirements Unsurprisingly if advertisers are allowed to bid very differently on similar individuals it is impossible to simultaneously achieve fairness and high platform utility As part of our study we also explore upper and lower bounds on the strength of a bid fairness condition needed to achieve a high platform utility Outline for the rest of the paper The remainder of this work is organized as follows related work is discussed in Section definitions and our formal model are introduced in Section algorithms achieving intra-category fairness are discussed in Section and algorithms achieving inter-category envy-freeness are discussed in Section composing these algorithms is addressed in Section finally future work is discussed in Section We defer proofs and some discussion to the full version of the paper RELATEDWORK Fairness in advertising is a topic of particular interest in the popular press as well as the empirical and theoretical computer science and economics literature There are number of compelling empirical studies and popular press articles demonstrating skew in advertisement delivery between groups either due to advertiser targeting choices platform delivery issues or competition between advertisers In the theoretical computer science literature Dwork et al proposed the notion of individual fairness as a fairness concept for settings including advertising Dwork and Ilvento consider individual fairness and group fairness in advertising as a composition problem and pose a limited set of fair composition mechanisms Similar to this work Kim et al propose Preference Informed Individual Fairness PIIF to capture the idea that deviation from individual fairness is acceptable as long as it is based on individuals preferences However while PIIF is intended to expand the definition of fairness within the context of task-specific metrics our preferences-based envy-freeness concept applies across multiple categories independent of the metric for each category Furthermore whereas Kim et al focus primarily on optimizing user utility via offline optimization across all fair outcomes we study online allocation algorithms and measure utility relative to the unfair optimum We view our work as complementary to and we anticipate that combining the insights from their perspective and ours will be useful for proposing alternative mechanisms and fairness relaxations Other works on fair advertising and related problems employ different notions of fairness With respect to group or statistical notions of fairness Celis et al propose a mechanism for ad delivery while maintaining certain group level statistics A variety of fairness notions have also been considered in related problems such as ranking recommendation systems and news search engines Finally mostly disjoint from the work referenced above there is an extensive literature in fair division concerning other notions of fairness The goal of one such notion called envy-freeness is to partition a limited shared resource among multiple agents with heterogenous preferences A major difference between this literature and the fairness literature referenced above is that envy-freeness is defined exclusively based on agents preferences and not on their traits or qualifications Two recent works Balcan et al and Zafar et al seek to combine notions of envy-freeness with parity-based fairness in machine learning in the context of classification ADVERTISING AND FAIRNESS MODELS We model the online advertising problem as follows A universe U of users arrive in an online fashion There are advertisers indexed by i When a user u arrives each advertiser i places a bid on the user The allocation algorithm then assigns allocation probabilities piu to the advertisers with i p i u The allocation algorithm is an online algorithm ie it assigns allocation probabilities without observing bids on users that arrive in the future or the ordering of future user arrivals Moreover we assume for simplicity that each user arrives at most once We use p to denote the allocation rule output by the allocation algorithm The goal of the allocation algorithm is to maximize the sum of the bids of the ads displayed Formally this is given by Utility p u U i i u We measure the utility of our algorithms against the best achievable in the absence of any fairness constraints The utility is easy to maximize in the absence of any constraints on how allocations vary across users the algorithm can simply assign a probability mass of to the highest bidder for every user utility the unfair optimum Unfair-OPT u U max i The Fair Value of an allocation algorithm is the ratio of its utility to the Unfair-OPT Note that this ratio is always less than the larger the fair value the better the utility of the allocation is Why compare with the unfair optimal utility instead of the fair optimal as do other related works First the utility of the fair optimal algorithm can be difficult to analyze due to the fairness requirements being revealed in an online fashion Second if there is a large gap between the utility of the algorithms we propose and the utility of the unfair-optimal algorithm the platform and advertisers may be unwilling to adopt the algorithm so it is critical that we compare with the platforms status quo Fairness of allocation Our fairness guarantees are based on the concept of individual fairness defined by and the well-studied concept of envy-freeness At a high level individual fairness guarantees that similar individuals are treated similarly Similarity between individuals is captured through a fairness metric d over U and similarity between outcomes is captured by defining a metric D over distributions over outcomes Definition Individual Fairness A function U O assigning users to distributions over outcomes is said to be individually fair with respect to distance metrics d over U and D over O if for all U we have Df u v Dwork and Ilvento proposed extending the notion of individual fairness to settings involving multi-dimensional allocations by ensuring fairness separately within each dimension or task This gives rise to the notion of multiple-task fairness which we now define in the context of online advertising Let C Cc denote a partition of the set of advertisers into c categories For c let denote a pseudometric over the users relevant to all advertisers in category U U In our setting the outcome assigned to each user u corresponds to the advertiser who is assigned to the slot for user u Our algorithm maps users to distributions over outcomes ie to the allocation probabilities piu We use the absolute difference between these probabilities to capture the similarity of allocations and multiple-task fairness becomes the following condition p satisfies multiple-task fairness with respect to distance metrics c if for all U c and i we have piu We will demonstrate that multiple-task fairness is too weak for fairness within a single category and it results in suboptimal allocations across categories from the perspective of envy-freeness We propose two new multi-dimensional fairness notions one applying across different categories and the other to multiple advertisers within the same category and combine these into the notion of compositional fairness that overcomes the shortcomings of multiple-task fairness Intra-category fairness First we consider a setting in which all of the advertisers belong to a single category ie c with a single metric that we denote by d eg a tech job-search website containing advertisements only from tech employers We observe that multiple-task fairness is insufficient to protect against two broad classes of problems Intentional unfairness It is vulnerable to subversion by malicious advertisers In particular consider an advertiser that submits multiple different ads pretending to be distinct advertisers for the same job and bids separately on each user for each of those ads The advertiser effectively poses as multiple sub-advertisers let S denote the set of these sub-advertisers In this case the multiple-task fairness constraint only ensures i v for each i and so it is possible that i S p i u i S p i v S As a result the advertisers may be able to amplify the difference in probabilities of allocation between two users to an arbitrarily large extent Unintentional unfairness Multiple-task fairness can also interact in undesirable ways with well-intentioned advertisers piu as a fractional allocation In this case the distance corresponds to the difference in the portion of allocation for each advertiser Suppose that the set S consists of all high-paying job ads on user v and the algorithm sets piu for all i S to maximize utility Then it would again be the case that i S p i u i S p i v S so the total allocation on high-paying job ads ie advertisers in S can be vastly different for u and v To rectify these issues we propose total variation fairness which requires that the allocation vectors pu and are not only close component-wise but are also close in terms of distance or total variation distance Definition Total Variation Fairness An allocation function p satisfies total variation fairness with respect to a metric d if for U and all S we have i S p i u i S p i v Equivalently for all U pu This stronger definition which provides guarantees on all subsets of advertisers S effectively mitigates the issues outlined above First it prevents the multiple bid attack by ensuring that i S p i u i S p i v Second it provides nice guarantees over substitutes in the following sense Consider a user u who regards some arbitrary subset S of advertisers to be substitutes In that case the probability that the user observes an ad from this subset is i S p i u and total variation fairness ensures that this sum is close to the corresponding sum for similar users belongs to a different category ie where c As the jack of all trades example in the introduction formalized in Section shows multiple-task fairness can lead to outcomes that although technically fair are undesirable from every stakeholders perspective users get low allocations in their desired categories advertisers reach far fewer qualified users and the platform gets low utility owing to the poor quality of the matching produced In this example allocations available to the jack of all trades are constrained by the limited attention of this single user a single ad slot in our model Multiple-task fairness combined with this constraint limits the allocations of all of the other users thereby hurting their utility without in turn providing any benefit to the jack of all trades Within this context we view the multiple task fairness objective to be unduly skewed in favor of a single individual over the collective good Is it possible to achieve a better balance It is if we slightly shift our viewpoint Consider a platform where each user is allowed to select the category they are most interested in with the guarantee that they see at least as many ads in this category as any other user In effect no user is envious of other users given their own choice of preferred category From a practical perspective the platform generally has a good deal of information about their users based on their previous web browsing behavior and may also have existing interfaces to allow users to view and modify these imputed preferences we anticipate platforms would include a fixed set of sensitive fairness definitions put forth in The definition essentially provides OR-fairness over all possible subsets of advertisers categories eg housing credit employment in every users preferences by default and augment this list with additional interests or preferences learned implicitly or explicitly specified by the user over time This approach accounts for the importance of ensuring inter-category fairness for certain sensitive categories either due to legal constraints or other ethical concerns and allowing a more flexible approach for less critical categories Now we discuss the fairness implications of this definition First in the special case where every category has a single advertiser user is much stronger than that guaranteed by individual fairness the user does not just obtain an allocation close to that of other similar users but rather obtains one that is as good or better than that of everyone else fairness guarantee on non-chosen categories However note that from the users perspective those other categories are anyway not important To take an example suppose that Alice and Bob are identical in terms of their credit-worthiness as well as job qualifications Suppose Alice is looking for a job and Bob for a credit card Then a platform that shows a job ad to Alice and a credit card ad to Bob makes both users happy and envy-free In contrast a platform that shows each user one of the two ads uniformly at random is multiple-task fair but makes both users worse off Third while our definitions focus on a single arrival of each user one may envision a system where a user interacting with the platform multiple times can change their preferred category at each interaction and thereby obtain a fair allocation within the chosen category at each individual interaction Finally observe that the envy-freeness guarantee is directional and entirely independent of distance metrics More generally we allow users to select multiple preferred categories and provide an envy-freeness guarantee with respect to the total probability of seeing an ad within their set of preferred categories Formally each user u picks a preferred set Su c of categories i Su p i u is at least as large as the corresponding sum for any other user v Definition Inter-Category Envy-Freeness An allocation function p satisfies inter-category envy-freeness with respect to preferred sets Su u U if for all U we have i Su p i v i Su p i u Compositional fairness Now we consider the general setting where there can be multiple categories and multiple advertisers in each category We discuss how to combine the two definitions above to provide hybrid fairness guarantees We have two goals each user should be envy-free with respect to the categories of ads they see and within each category the mix of ads presented to each user should satisfy our strengthened notion of individual fairness For example suppose that two similarly qualified users Alice and Bob both select jobs as their preferred ad category Not only should those advertisers in the subsection on compositional fairness could obtain a large allocation at the expense of advertisers that dont want to target such a user Note that advertisers can bid on users that are not targeted and thereby pay nothing for those users Furthermore it is rare for a user to be wholly unqualified for a category from the perspective of advertising For example an individual who is unqualified for a job is likely a good candidate for a job training ad categories on a user profile the two users then see job ads with the same total likelihood but they should also see a similar mix of high-paying and low-paying job ads This composition of definitions becomes subtle when users select multiple preferred categories Suppose that Alice continues to choose jobs as her preferred category but Bob chooses both jobs and household product ads Suppose further that Alice is allocated a job ad with probability and Bob sees an ad in each of the two categories with probability each This allocation satisfies inter-category envy-freeness However within the job ads category there is no way to assign probabilities that satisfy unconditional total variation fairness simply because of the fact that we have different total probabilities to distribute Intuitively we want Bob to be able to see the same mix of ads as Alice even though Alice may see job ads more frequently overall Accordingly we enforce total variation fairness on the conditional distribution of allocation within each category Formally we define compositional fairness as follows We use to denote the metric specific to category and q u i p i u to denote the total allocation within category for user u Definition Compositional Fairness An allocation function p satisfies compositional fairness with respect to distance metrics c if the assignments q u u U c satisfy inter-category envy-freeness and for each c such that q u the conditional probabilities piu q i satisfy total variation fairness with respect to Multiplicative Relaxations We can further refine each of the above notions by defining multiplicative relaxations parameterized by total variation fairness for U we have pu inter-category envy-freeness for all U we have i Su p i v i Su p i u compositional fairness q u u U c satisfies inter-category envy-freeness and for each c such that q u piu q i satisfies total variation fairness INTRA-CATEGORY FAIRNESS In this section we focus on the case where advertisers are in a single category c ie where advertisers face the same metric over users in particular d d d Our main result in this section is an allocation algorithm that is fair when advertiser bids are fair and achieves a high fair value Our allocation algorithm also enjoys the property of metric-obliviousness That is the platform does not require knowledge of the fairness metric d In Section we describe the need for a fairness condition on advertiser bids that we call a bid ratio condition In Section we investigate the special case of uniform metrics and establish impossibility results ie upper bounds on the fair value of any allocation algorithm that satisfies multiple-task fairness as a function of the bid ratio condition In Section we consider settings with arbitrary distance metrics and exhibit an allocation algorithm that is metric-oblivious history-oblivious and achieves total variation fairness with respect to the given metric with an appropriate bid ratio condition We then bound the fair value achieved by this algorithm as a function of the number of advertisers and a parameter defining the bid ratio constraint Moreover we show that this algorithm achieves a near-optimal tradeoff between bid ratio condition and fair value within a restricted class of algorithms In Section we show that the fair value achieved by this algorithm is close to the upper bound established in Section for allocation algorithms with a uniform metric We emphasize that while our negative result in Section applies to general online algorithms which satisfy multiple-task fairness with access to the underlying metric our positive result applies to a algorithm that is metric-oblivious and satisfies the stronger notion of total variation fairness All of the proofs can be found in the full version of the paper Fairness in bids Our goal is to develop an allocation algorithm that simultaneously satisfies total variation fairness and achieves large fair value with respect to the Unfair-OPT As one might expect it is impossible to achieve this if advertisers are allowed to place arbitrary bids on users without regard to the relevant similarity metric over users The question thus becomes what kind of fairness constraint on bids enables a reasonable fair value The following example illustrates the need for a fairness constraint that requires an advertisers bids on pairs of similar users to be close in ratio even when allocations are merely required to satisfy the weaker condition of multiple-task fairness In particular being close in terms of their absolute difference is not sufficient to achieve a good fair value Example Suppose that there are advertisers and exactly users Suppose that the metric is uniform for some parameter d every pair of users is a distance of d apart For each i advertiser i bids b high on user i and blow on all other users i Observe that Unfair-OPT kb high On the other hand due the symmetry of this instance and the fact that a fair allocation requires that pii p i d for each user it turns out the optimal fair allocation assigns an allocation probability of to all advertisers with the low bid and a probability of d to the advertiser with the high bid The fair value of this allocation turns out to be d d d b low Observe that a fair value of d is trivial to achieve via a fair allocation d is very small this trivial bound is tiny If blow then in this example no fair allocation can perform much better than the trivial algorithm In order to be able to do better b high low must be bounded Motivated by the example above we require that for every advertiser and every pair of users the ratio of the bids the advertiser places on the users is bounded by a function of the distance between the users according to d The closer the two users the closer this ratio bound should be to on the other hand the ratio bound should be large between far apart users We formally define this constraint as follows the highest bidder and d to all other advertisers achieves this bound Figure Bid ratio condition fl d d d Definition A bid ratio constraint is a function We say that the bid function bi of advertiser i satisfies the bid ratio constraint with respect to metric d if we have for all U b b iv How should we choose On the one hand the bid ratio constraint needs to be sufficiently strict to provide meaningful fairness and utility guarantees and on the other hand it cannot be so overly restrictive as to prohibit reasonably expressive bidding strategies We characterize by boundary conditions for identical users and maximally distant users with the requirement that is weakly increasing and in the intermediate range In the case of identical users ie the advertiser is required to place identical bids ie For maximally distant users ie we choose allowing advertisers to bid arbitrarily differently on this pair For ease of analysis we also make continuous In this work we show that a specific parameterized class of bid ratio constraints that satisfy the above properties performs well in terms of fair value The family is parameterized by l and is defined as fl d d d l Figure displays some functions in this family Note that as the parameter l increases the bid ratio condition becomes more and more strict A further discussion of the structural properties of fl d can be found in the full version We emphasize that bid ratios are not required to satisfy the constraint exactly but rather should lie at or below the imposed curve From an algorithmic viewpoint this means that if we design an algorithm based on the polynomial family described above but the actual bid ratio constraint imposed on bids say does not belong to this family it nevertheless suffices for the algorithm to find a value of the parameter l for which fl d for all d and use the function fl in making allocations Upper bounds on fair value with uniform metrics We prove upper bounds on the fair value of any allocation algorithm that satisfies multiple-task fairness Observe that these upper bounds apply also to total variation fairness which is a stronger requirement We use uniform metrics ie metrics of the form d for v We use Example to show an upper bound on the fair value as a function of the bid ratio constraint Lemma Given d and d there exists an instance of the online advertising problem for which the fair value of every offline allocation algorithm satisfying multiple-task fairness with respect to the uniform metric d is at most d d d Observe that as d increases the upper bound on the fair value increases due to a weaker fairness constraint on setting allocation probabilities On the other hand for any fixed d and as increases weakening the fairness constraint on bids the algorithms performance becomes worse In the online setting it is possible to prove even stronger bounds on the fair value in the fair value to In the full version of the paper we develop online allocation algorithms that are tailored to uniform metrics and achieve a fair value that nearly matches these lower bounds demonstrating that stronger lower bounds for general online algorithms cannot be obtained through uniform metrics Lemma Given d and d there exists an instance of the online advertising problem for which no online allocation algorithm satisfying multiple-task fairness with respect to the uniform metric d can obtain fair value better than d d d Algorithms for the general metric case We construct an allocation algorithm for a general fairness metric d that achieves total variation fairness and a large fair value From a algorithm design standpoint it is desirable for our algorithm to satisfy certain other properties Most important is metric-obliviousness ie where the algorithm doesnt require direct knowledge of d In addition the following other properties are desirable Identity-obliviousness that is the algorithm treats advertisers in a symmetric manner in each individual iteration the allocation to an advertiser does not depend on their identity Monotonicity that is the allocation probabilities increase monotonically as functions of the advertisers bids which means that we can make this algorithm truthful by setting the payoffs appropriately by Myersons lemma History-obliviousness which has the nice implication that the memory required by the algorithm is independent of the number of users and the solution is independent of the ordering of the users so we dont need to worry about impact of the order in which the users are given on advertiser strategies and/or utility Protecting against advertiser splitting We would like the algorithm to disincentivize an advertiser from splitting up into sub-advertisers or submitting multiple ads in an attempt to obtain a higher probability allocation We now describe a class of algorithms that satisfy these properties The key intuition is to convert the bids on a user into probabilities using a function that places higher probabilities on higher bids Note that the first three properties identity-oblivious monotonic and history-oblivious mean that the algorithm must adversary is given access to the probabilities output by the algorithm when designing the next set of bids be defined by a symmetric coordinate-wise increasing function G R p pk pi i p i that maps bids into probabilities We observe that the overall optimal solution Unfair-OPT can be placed in this framework the algorithm that distributes the probability mass equally among the highest bidders for each user corresponds to the function that places the full mass on the highest bids This function can be viewed as assigning allocation probabilities in proportion to their contribution to the ℓ-norm over the bids Proportional allocation algorithms One rich class of algorithms of this form are algorithms where the probabilities are proportional to some deterministic function of the bids ie where piu with appropriate normalization to make i p i u We call these algorithms proportional allocation algorithms defined as follows additive ie y increasing function The proportional allocation algorithm with parameter assigns piu i u for every user u U and advertiser i It is straightforward to verify that proportional allocation algorithms are identity-oblivious monotonic history-oblivious and protect against submitting multiple ads this last property follows from the super-additivity of These algorithms bear similarity to position auctions highest probability regardless of their identity A proportional allocation algorithm with high fair value We construct a family of functions where the fair value of the proportional allocation algorithms is high More specifically we show that x l for l can achieve fair value approaching as l This algorithm can be viewed as assigning allocations in proportion to each bids contribution to the -norm of the bid vector We emphasize that our bound on the fair value does not require bids to satisfy the bid ratio constraint Theorem be a proportional allocation algorithm with parameter x l for a positive integer l If and l then the fair value is at least Observe that fair value is an increasing function of l and as l where M places the entire mass on the highest bid the bound equals as expected This means that fair value can be made arbitrarily close to by sufficiently strengthening the bid ratio constraint To achieve a fair value of r we can set l We show that with the bid ratio condition fl d d d shown in Figure this algorithm satisfies total variation fairness Theorem be a proportional allocation algorithm with parameter x l for a positive integer l If all advertisers in a category satisfy the bid ratio condition fl d d d M satisfies total variation fairness in that category in a different context in not the bid values or advertiser identities in determining the allocation See the full version of the paper for a discussion of why position auctions cannot achieve both fairness and a high fair value Observe that the bid ratio condition becomes stronger as l increases Thus for a fixed number of advertisers a higher fair value is accompanied by a stronger bid ratio condition Moreover observe that to maintain a fair value of r a stronger bid ratio condition is needed as the number of advertisers increases since l grows with Near-optimality within proportional allocation algorithms A natural question is to ask is whether Algorithm with a different function can achieve a a much better fair value potentially using a differently shaped bid ratio condition In fact we show that Algorithm is nearly optimal within the family of proportional allocation algorithms We specifically prove that any proportional allocation algorithm achieving a certain fair value will have a corresponding bid ratio condition that is point-wise stronger than fl d d d where l within a constant factor of what is achieved by Algorithm with x l This result demonstrates that changing the shape of the bid ratio condition will not significantly improve the fair value We show the following lower bound Lemma Suppose is a proportional allocation algorithm achieves fair value r and achieves total variation fairness with a bid ratio condition of For l we have that d fl d d d for infinitely many points on more specifically for d D d d m m n n n N How does the lower bound in Lemma compare to the proportional allocation algorithms with parameter x l Lemma shows that any proportional allocation algorithm will satisfy d fl d where l for infinitely many points on the curve Meanwhile Theorem and Theorem show that to achieve a fair value r it suffices to take fl d with l Thus there is essentially a constant factor difference in the lower and upper bounds on l A consequence of Lemma is in the family of proportional allocation algorithms the fair value must necessarily degrade with the number of advertisers if the bid ratio condition is fixed Or equivalently to maintain a fair value of r a stronger bid ratio condition is needed as the number of advertisers increases In fact Lemma implies that that the proportional algorithm with parameter x l achieves the optimal rate of change of the bid ratio condition as a function of within the family of proportional allocation algorithms a better dependence on is not possible Discussion In Section we showed that Algorithm with x l is nearly optimal in the class of proportional allocation algorithms Now we compare Algorithm with x l to general online algorithms using our negative results in Section It is a little tricky to directly compare the fair value lower bounds achieved by Algorithm with x l with the upper bounds in Section because the bounds depend on different parameters In particular the lower bounds hold for arbitrary metrics whereas the upper bounds are designed only for the uniform metric To perform an apples-to-apples comparison we fix parameters l and some number d and fl d a l b l c l d l Figure Illustrations of the ratio of upper and lower bounds on fair values for different values of l Note that the z-axis scale for l differs from the others Figure displays the ratio of the upper bound and lower bound for various parameter settings Observe that the ratio is bounded by a reasonably small constant except when l is very small This indicates that Algorithm with parameter x l in general obtains a large fraction of the utility that can be obtained by any online algorithm satisfying multiple-task fairness despite satisfying a stronger form of fairness and nice algorithm design properties INTER-CATEGORY FAIRNESS We consider the setting where different product categories correspond to very different metrics We specifically consider the setting where every category has exactly one advertiser ie where c We first show it is not possible to achieve the same tradeoff between multiple-task fairness and utility as in the case of identical metrics We then show that with inter-category envy-freeness significantly better tradeoffs are possible We present tight upper and lower bounds on the fair value achievable as a function of upper bounds on the sizes of the preferred sets In Section we focus on the Unfair-OPT benchmark considered in the previous section In Section we argue in favor of a relaxed benchmark to evaluate the performance of fair allocation algorithms and show that this benchmark can be exactly met by algorithms that satisfy inter-category envy-freeness Proofs are in the full version of the paper Inter-category envy-freeness and fair value relative to Unfair-OPT First we show a upper bound that demonstrates that multiple-task fairness is in conflict with utility even in the offline setting if the metrics are permitted to be different The result is based on the jack of all trades example in the introduction Formally Example Jack-of-all-trades Suppose that the universe has c users u and there are c categories with one advertiser per category The metric di is defined so that di and all other distances are Suppose that advertiser i bids on and and on everybody else Observe that the bids are fair assuming Consider any allocation algorithm and suppose that this algorithm chooses an ad from distribution q qc to display for user Then in order to respect multiple task fairness as defined above the algorithm cannot allocate ad i to user with probability greater than As a result most of the specialists necessarily obtain a low allocation within their desired categories since the jack of all trades can only be served a single ad the specialists are penalized Multiple-task fairness thus limits the allocation of almost all of the users Moreover the utility of any fair allocation is bounded by some constant whereas an unfair allocation can achieve utility c We obtain the following bound on fair value Proposition Suppose that bids satisfy the bid ratio constraint then no offline algorithm that satisfies multiple-task fairness across c categories can obtain a fair value more than c We now consider the weaker fairness notion of inter-category envy-freeness defined in Section that limits the number of fairness constraints imposed by any given user We assume that the platform obtains from each user u U a preferred set Su c of categories as the user arrives ie the preferences are not known to the allocation algorithm in advance Inter-category envy-freeness requires that the total allocation of ads in Su to the user u should be at least as large as the total allocation of ads in Su to any other user Observe that our definition of fairness doesnt involve a metric over the users Moreover obtaining good utility requires that we place a reasonable amount of mass on the highest bids for the user u We develop an allocation algorithm that reserves some allocation mass for the category with the highest bid on each user u and distributes the remaining allocation probability across categories in Su In doing so we must ensure that no subset of categories gets too much mass in total This is because if such a set S exists and a future user v sets S then the algorithm is forced to give a high allocation to this set for user v Unless S is small this may then leave little probability mass for the highest bidder for v We now formally define our algorithm and bound its fair value Algorithm The equal-spread algorithm with parameters is defined as follows We assume that every user u specifies a subset Su c with Su C argmax jc b u be a category with the highest bid The algorithm assigns an allocation probability of p high to and p fairness to categories in Su where p high Su The parameter allows the algorithm to trade-off between fairness and utility By allowing the algorithm to achieve β-intercategory envy-freeness for larger values we obtain a better approximation to the Unfair-OPT Theorem If every users preferred set contains C categories then for any the equal-spread algorithm with parameters and C Algorithm satisfies β-inter-category envy-freeness and achieves a fair value of We show a matching upper bound on the fair value thus showing that Algorithm is optimal Our proof boils down to bounding the Figure Fair value for inter-category envy-freeness amount of mass that can be placed on the highest bid We construct a sequence of users with the property that bids in Su are always and each user has a category Su that bids We adaptively construct the sets Su and to minimize the fair value Lemma Suppose c and every users preferred set can contain any number of categories C Then regardless of the bid ratio constraint imposed on the advertisers but assuming any online algorithm that satisfies β-inter-category envy-freeness obtains a fair value of at most In the above construction we consider a uniform metric with distance where the bid ratio conditions do not implicitly provide any guarantees Nonetheless even though the users are maximally distant the inter-category envy-freeness still provides strong unidimensional guarantees between these users A natural question to ask is can we achieve a higher fair value by considering a relaxed version of inter-category envy-freeness that reintroduces the metric We show in the full version of the paper that it is not possible to do better We plot the tight bound on fair value obtained for inter-category envy-freeness as a function of and C in Figure Observe that as increases the weakened fairness guarantees cause the fair value to increase For the dependence on C observe that the algorithm must balance between allocating to a category with the highest bid to achieve high utility and allocating to categories in Su to achieve inter-category envy-freeness As C increases the algorithm has a greater number of categories to consider for each user and the highest bid can still be outside of Su thus causing the optimal fair value to decrease Relaxing the utility benchmark The results in the previous section for the strongest form of fairness place an upper bound of or lower on the fair value that can achieved by inter-category envy-freeness In this section we consider the setting where we restrict to algorithms that receive utility only for allocations in Su that is the utility is u U i Su p i i u In this case we assume that user-specified categories are aligned with interest and in a click-through-rate based revenue/utility model the platform only obtains benefit from allocations within the user-specified sets It is straightforward to see that the best possible utility achieved by any potentially unfair algorithm in this restricted class is u U maxi Su b i u which may be much smaller than unrestricted optimal utility of u U maxi c b i u This motivates considering the relaxed fair value given by i u max b When there can be more one advertiser per category we define the relaxed fair value as p u max b u Returning to the case where there is at most one advertiser per category we show a strong positive result the simple highest-bidder-wins algorithm achieves inter-category envy-freeness and a relaxed fair value of even when the sets Su are large Algorithm For each u U the algorithm allocates a probability of to the category in Su with the highest bid If there are multiple categories tied for the highest bid then the algorithm splits the probability equally between these categories Theorem Algorithm achieves inter-category envy-freeness with and achieves a relaxed fair value of Given the simplicity of Algorithm a natural question is to ask is can we obtain better fairness guarantees while still maintaining a high relaxed fair value We show in the full version of the paper that it is not possible to have multiple-task fairness guarantees and a high fair value even against the relaxed benchmark COMPOSITIONAL FAIRNESS We now discuss how to combine our algorithms to handle the setting where there can be multiple categories and multiple advertisers in each category Let C Cc denote a partition of the set of advertisers into c categories We can compose our algorithms from Section and Section by running algorithms from Section to allocate probability between categories and algorithms from Section to distribute the probability assigned to a category between advertisers in that category The intuition for fairness is that compositional fairness is implied by inter-category envy-freeness and intra-category total variation fairness fair value since the fair value of the composed algorithm is the product of the fair values of the individual algorithms Finally the composed algorithms are metric-oblivious as a direct consequence of our intra-category and inter-category algorithms enjoying this property Proofs are in the full version of the paper Note that the two choices of category selection algorithms in Section result in combined constructions that differ in terms of both utility guarantees ie choice of benchmark and category distribution properties ie concentrating or spreading probability between categories which are important for practical considerations High fair value compared to relaxed benchmark To achieve a high fair value compared to the relaxed utility benchmark taking user preferences as an indicator of click probability discussed in Section we can compose Algorithm with Algorithm The idea is that we run Algorithm to identify the category in Su with the highest bid and then we run Algorithm to divide the probability mass between advertisers in this category p i u is actually the probability the first algorithm assigned to category Cl we require that the second algorithm assigns the full probability mass to each user This is true of proportional allocation Algorithm Algorithm For each user u the algorithm runs Algorithm to allocate probabilities between categories where for c the bid B is taken to be maxi b i u The algorithm then determines the conditional probabilities for advertisers within each category using Algorithm with parameter x l Theorem Let max jc be the maximum number of advertisers in any category If all advertisers i satisfy the bid ratio condition i d d d then Algorithm achieves compositional fairness and a relaxed fair value of at least High fair value compared to Unfair-OPT It is likewise possible to combine algorithms and to obtain bounds on the fair value against Unfair-OPT Algorithm For each user u the algorithm runs Algorithm with parameters and C to allocate probabilities between categories where for c the bid B u is taken to be maxi b i u The algorithm then determines the conditional probabilities for advertisers within each category using Algorithm with parameter x l Theorem Suppose that every users preferred set contains at most C categories Let max jc be the maximum number of advertisers in any category If all advertisers i satisfy the bid ratio condition i d d d then Algorithm achieves compositional fairness and a fair value of at least FUTURE WORK In this work we give an initial framework for understanding the utility and fairness properties of a combination of individual fairness and envy-freeness We highlight areas for future work below Advertiser incentives In order to use implement our allocation algorithms as mechanisms it is necessary to consider advertiser incentives Our allocation algorithms satisfy nice properties such as monotonicity and individual rationality which serves as a starting point Nonetheless a full consideration of incentives requires considering how the bid fairness constraints impact advertiser bidding strategies Closing the gaps and tighter upper bounds In Section we showed general fair value upper bounds using uniform metrics and showed stronger upper bounds for proportional allocation algorithms An interesting direction for future work would be to show upper bounds for general metric oblivious algorithms and compare these bounds to Algorithm with parameter x l Multiple slot auctions In this work we have focused on the case of single slot auctions However in practice multiple slot auctions or auctions where each user appears at several times are more common This leaves open several considerations in defining fairness such as how to account for the ordering of advertisements Different combinations of inter- and intra-category fairness We give one combination of inter- and intra-category fairness but its likely that other combinations eg intra-category total variation fairness and inter-category PIIF may be of interest