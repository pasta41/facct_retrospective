Bidding Strategies with Gender Nondiscrimination Constraints for Online Ad Auctions Interactions between bids to show ads online can lead to an advertisers ad being shown to more men than women even when the advertiser does not target towards men We design bidding strategies that advertisers can use to avoid such emergent discrimination without having to modify the auction mechanism We mathematically analyze the strategies to determine the additional cost to the advertiser for avoiding discrimination proving our strategies to be optimal in some settings We use simulations to understand other settings CONCEPTS Information systems Online advertising KEYWORDS targeted advertising online auctions fairness constraints MDPs INTRODUCTION Prior work found Google showing an ad for the Barrett Group a career coaching service promoting the seeking of high paying jobs more often to simulated men than to simulated women Later work enumerates possible causes of this disparity One possibility raised by Google itself is that the Barrett Group targeted both men and women equally but other advertisers on average focused more on women which would be in line with subsequent findings In this possibility the Barrett Group found itself outbid for just women by the other advertisers who were willing to pay more than it was for reaching women but not for men These other advertisers might be promoting products that many find acceptable to target toward women such as dresses Thus its possible that each advertisers targeting appears reasonable in isolation but interacts to bring about emergent discrimination for a job-related ad For conscientious advertisers of products that should be broadcasted to women and men at equal rates such an outcome is unacceptable but currently difficult to avoid While Google offers the ability to skew ads toward men or toward women it provides no way to ensure that both men and women see the ad an equal number of times As discussed above simply not targeting by gender is not enough to guarantee parity Even running two ad campaigns of equal size is insufficient since the size is determined by budget and not the number of ads shown which means that parity would only be achieved if women and men are equally expensive to reach We consider how advertisers can ensure approximate demographic parity for its ads without changing Googles ad auction mechanism which is based on a second-price auction Given that an advertiser wishes to maximize its utility by reaching the people most likely to respond to its ads we model the advertisers utility function along with the parity goal as a constrained bidding problem We consider both a strict absolute parity constraint and a more relaxed relative constraint inspired by the US EEOCs four-fifths rule on disparate impact Although using a second-price auction suggests that the advertisers should bid their true value of showing an ad a parity constraint and multiple rounds of the auction interact to make deviations from this truthful strategy optimal Intuitively as in multi-round second-price auctions with budget constraints it is sometimes better to bid less to preserve the ability to participate in later auctions that might have a lower cost of winning More interestingly unlike with just budget constraints it is also sometimes better to bid more to ensure an acceptable degree of parity enabling participation in other auctions later Given these complexities finding an optimal bidding strategy for such a constrained bidding problem is non-trivial We do so by modeling them as Markov Decision Problems MDPs Solving these MDPs using traditional methods such as value iteration is made difficult by the continuous space of possible bid values over which to optimize To avoid this issue we find recursive formulae for each type of constraint providing the optimal bid value and solve for their values instead This approach allows us to solve the MDPs without needing to explicitly maximize over the possible actions as in value iteration We compare this optimal constrained bidding strategy to the optimal unconstrained strategy for both real and simulated data sets The cost to the advertiser for ensuring parity varies by setting but is manageable under the more realistic settings explored In all cases the revenue of the simulated ad auctioneer Googles role remains roughly the same or goes up By not modifying the core auction algorithm used by Google and instead suggesting bidding strategies that could be deployed by the advertisers we believe this work provides a practical path towards nondiscriminatory advertising RELATEDWORK The most closely related work recently looked at enforcing parity constraints with auction mechanisms whereas we do so with bidding strategies While both approaches have their use cases we believe ours is easier to deploy since just the advertisers wanting the feature need to make changes to implement it We further discuss tradeoffs between deployment approaches in Section Our approach also differs by using strict constraints whereas theirs uses probabilistic constraints Probabilistic constraints allow more utility but may be insufficient in cases where approximate parity is required as when disparate impact is prohibited At an algorithmic level they differ by using gradient decent A similar alternative approach could use auction mechanisms with Guaranteed ad Delivery GD An advertiser can act as two parties to the auction one for each gender and use GD to ensure an equal number of wins for each party Unlike our bidding strategy which an advertiser can unilaterally employ this approach requires the ad exchange to change its auction mechanisms Prior works have looked at how to enforce proportional parity constraints on the classifications produced by ML algorithms We instead look at auctions Prior works have used MDPs to model ad slot auctions Li et al and Iyer et al have used them to find optimal bidding strategies when advertisers do not know the exact values of each type of ad slot and learn values by winning them They showed that advertisers should overbid to learn more information Gummadi et al described the optimal bidding strategy for the second-price auction in which each advertiser has a limited budget which leads to underbidding Zhang et al derived optimal real-time bidding strategies when each ad slot have different properties ONLINE AD AUCTIONS When a person visits a webpage the webpage will often contain dynamically loaded ads at fixed locations on the page These ads each occupy an ad slot a location at a time or page load on the webpage In some cases the website selects which ads to show in which slots itself such as with Facebook In other cases the website contracts with a third-party to fill and charge for the slots in exchange for payments to the website In either case we call the entity choosing how to fill the slots an ad exchange For example Google runs an ad exchange Google Ad Manager which includes slots put up for sale by websites with its AdSense tool Typically an ad exchange auctions off the slots it controls to advertisers It can use real-time bidding to auction off the slots as the webpage loads The website and the ad exchange can offer advertisers various amounts of information about the slot such as the webpage it is on and demographics about who is loading the page Advertisers performing programmatic advertising use a dynamic bidding strategy that adjusts their bids according to how well they expect their ads to perform in the offered slot To avoid having to create programs for executing such strategies on their own advertisers often use a demand-side platform DSP Figure demonstrates a sketch of the interactions An ad exchange may accept bids that are more complex than just a single price such as including an offer to pay a bonus if the website visitor clicks the ad Exchanges wishing to maximize Ad Exchange Person Request a page Request an ad Return an ad Get advertisers bids Find the best advertiser DSP Advertisers Receive page with ad DSP Figure Online advertisement interactions the amount of bonuses it receives or to avoid annoying visitors might consider the quality of the ad and its fit for the slot For simplicity we will defer further consideration of these complications to Section and presently presume that all bids are simply offers to pay for showing the ad Second price auctions is a common mechanism for resolving such auctions with Google using a variation of one and we will presume the ad exchange uses one In this auction mechanism the exchange selects the highest bidder as the winner but only charges the bidder the price offered by the second highest bidder Under certain circumstances this mechanism ensures that each bidders optimal strategy is to bid the actual amount it values the slot at making the mechanism truthful Since ad exchanges sometimes sell more than one slot at time such as for a webpage with multiple slots they often use generalized second-price auctions known as position auctions We model the above economy as a sequential game of incomplete information where in each round of the game a set of self-interested rational advertisers bid to win an ad slot through a second-price auction We allow bids to vary over auctions and assume that each advertiser has a geometric lifespan For simplicity we make the total number of advertisers equal in all auctions by assuming that every time an advertiser dies a new advertiser joins At time t each advertiser i submits a bid Let b t i be the bids of other the advertisers The ad exchange platform runs a second-price auction where advertiser i wins the ad slot if its bid is higher than all other bids max i For simplicity we assume no ties ensuring that such a winner exists Let be if the advertiser i wins at round t and be otherwise If the advertiser i wins it will pay the second highest bid max i The cost of the auction t is d t i since the advertiser i only pays if it wins The ad slot auctioned at t has a value for the advertiser i When an advertiser i wins auction t it gets an immediate reward which is the value less its price d t i Thus the utility of advertiser i gained at each round is uti v t i c t i v t i d t i Let the geometric parameter for the lifespan distribution for advertiser i be The total utility for each advertiser t t i a t i v t i d t i where ti is raised to the t th power not indexing by t The advertiser i should select its bids to maximize the expected value of where the expectation is over its value and the bids of other advertisers i The advertiser can use market research its prior experiences and any information provided by the ad exchange to estimate these uncertain values In the case of a pure second-price auction the values of the other bids i are irrelevant and the optimal strategy is to always set its bid equal to its estimation of its value However this result does not carry over to all second-price auctions with constraints including the parity constraints we consider In this case the behavior the other advertisers matters but estimating it for individual ad slots is difficult Furthermore the advertiser is unlikely to estimate the value of every ad slot individually even for a pure second-price auction Rather the advertiser will likely model ad slots as each having a type belonging to a set of reasonable size The types will represent the most important information to the advertiser about the slot For simplicity we will typically assume that has just two types one for each gender For each type the advertiser will estimate the expected value of a slot of type For estimating the other bids prior research has shown it reasonable to model them as coming from a stationary fixed distribution due to the large number of other advertisers To simplify our analysis we denote the CDF of other bids for a slot of type by Finally let p i be the probability that advertiser i assigns to the type With these estimations we compute estimations of other key quantities The probability of winning on auction t for a slot of type with a bid of x is Pr max i x x where is the number of advertisers at each ad slot auction The expected value of the utility for the advertiser i for a single auction given the distribution of the other advertisers bids is t i i v t i d t i The expected value of the total utility for each advertiser is t ti t i i v t i d t i PARITY CONSTRAINTS Advertisers may have concerns in addition to attempting to maximize the utility such as complying with laws and social norms In some cases this will include ensuring that its ads reach various protected groups to the same degree For example an employer may desire that a job ad be shown to an equal number of women and men to comply with laws prohibiting gender discrimination in hiring Such advertisers would like to place their bids in a manner to ensure such demographic parity However the above auction mechanism as well Googles actual mechanism as far as we can tell does not offer any way of ensuring that a job ad is shown to an approximately equal number of women and men as required by laws prohibiting gender discrimination in hiring Furthermore ad exchanges may be unwilling to support such constraints given that only some advertisers have such concerns Thus our goal is to provide advertisers with a bidding strategy that dynamically adjusts bids to preserve the gender parity of the viewers which advertisers can unilaterally use without needing changes to the auction mechanism of the ad exchange As an additional benefit of not modifying the ad auction mechanism our bidding strategy can be used for any type of auction However we design and analyze them with only with second-price auctions in mind We will focus on an advertiser that wants to show an ad to equal numbers of men and women A particularly careful advertiser may desire that this parity constraint holds not only at the end of ad campaign but throughout Such continuous parity ensures that the advertiser would pass an audit checking for this property at any point in time It also ensures meeting the parity goal if the the ad campaign must be cut short or if a sudden influx of competing advertisers prevents winning addition slots Meeting this strict goal is impossible since the first ad must go to either a man or woman and not both To account for this we relax this goal to allow for approximate parity We distinguish between absolute additive and relative ratio approximate parity and first consider an absolute constraint An advertiser has-K-parity if after each auction the maximum difference between the number of auctions that it wins for each gender is not more than Our goal is to find the optimal bidding strategy for advertisers obeying such a constraint This task is difficult since a constrained advertiser must consider not just the immediate reward of winning a slot but also how it may close or open the possibility of winning additional slots later To see this we will consider three examples involving a simplified setting in which an advertiser i is subject to parity and knows exactly how long it will live In each example it values men and women both at with no variance but other advertisers value women at an expected value of and men at an expected value of This setting reflects that advertisers are willing to pay more on average for women than men In the first example we consider the advertiser knows that it will live for exactly one ad auction In this case the advertiser i will bid the value of the immediate reward that it receives for winning an auction regardless of whether it is subject to a parity constraint since winning the auction has no effect other than that immediate reward It will win an auction for a man and lose an auction for a woman Next consider the advertisers behavior for a series of two auctions The interesting case is two men in a row In this case advertiser i can only win one of the slots since it is subject to a parity constraint Thus the utility of the advertiser will be smaller from having parity but it need not be half that of when it is unrestricted If the number of women is small enough p the advertiser can assume it will get two men in a row and can lower the value of its bid on the first man in hopes of winning at a discount given the fluctuations in the other advertisers bids We call this underbidding although we emphasize that it is underbidding with respect to its immediate reward not with respect to what is overall rational Underbidding effectively allows the advertiser i to skip the first auction if the variance in the other advertisers bids produces a high competing bid This is similar to how underbidding is optimal in some repeated second-price auctions with a constrained budget The degree of underbidding must balance the chance of getting a male slot at a discount with the risk of either losing both auctions or getting a female slot for the second auction The opposite overbidding can also occur To see this consider a series of three auctions with a woman followed by two men In this case the advertiser i can win both men despite the parity constraint provided that it first wins the woman Thus winning the woman produces not just an immediate reward but also a future reward by unlocking the ability to win more men If we presume negligible variance in the other bids the advertiser i will have to bid to win the woman and pay the second price of yielding an immediate reward of by bidding over the the advertisers inherent value of for the female ad slot Since the immediate reward of a male slot is being able to win the second man means a net positive gain of We ignore the effects of underbidding since we are now considering negligible variance in the other advertisers bids which makes the effect go away We find this distinction between the immediate reward and the future rewards coming from future flexibility useful for determining the optimal bidding strategy However doing so requires not only making the above intuitions quantitative but also dealing with additional probabilistic factors such as the genders of ad slots not being known in advance and the uncertain duration of the auction sequence To overcome these difficulties we switch to a more systematic model for each type of constraint ABSOLUTE PARITY CONSTRAINTS To make absolute constraints precise let denote a set of groups We are typically interested in the case where with m denoting men and women We use p to denote the probability of a male ad slot ie pmi We use n i to denote the number ad slots for people in group won by the constrained advertiser i Definition K-parity An advertiser i obeys a K-strict absolute parity constraint or K-parity for short for a set of groups after each auction for all groups and in the number of auctions that it wins satisfies n i The constraint is strict by requiring that approximate parity holds at all times with certainty and not merely with high probability We study approximating the optimal bidding stagy that an advertiser desiring to meet a K-parity constraint can use to do so In our analysis we assume all of the advertisers have an unlimited budget Thus they can bid on all auctions in its lifespan unless maintaining the K-parity constraint precludes it Modeling To find the optimal bidding strategy for an advertiser subject to K-parity we model the problem as a Markov Decision Problem MDP The obvious state space for such an MDP would have states of the form n i where n m i and is the current number male and female slots won respectively and is the type of the ad slot currently being auctioned off which we presume corresponds to a gender could be generalized to allow targeting toward certain men and women Observing that only n i matters we instead use a smaller space of states We denote each state by a tuple where is the difference between male and female slots won When the advertiser wins an ad slot for a male viewer the advertiser goes from state to for a female it goes from to The value of the is decided by a random process depending upon the value of p where p is probability of the viewer being male To find the optimal solution we write the Bellman equation for the MDP in the steady state Since we consider the steady state regime we also replace the value of each ad slot by its expected value ie The value function for each state except for the two states m and has two parts a reward function R that indicates the immediate reward of taking action bi and N that is the future value the advertiser gets by doing that action We write the value functions as follows V max bi bi i bi i and R m i show the reward value that advertiser i will receive if it wins an ad slot auction viewed by female or male bi i i v i d i N bi the future value that advertiser i gets by bidding bi at state consists of two parts The first part N win is the value that the advertiser gets if it wins while the second part N lose is the value when it loses We treat as providing both m i and N bi i N wink i N lose with wink wink N lose As for the two edge cases their values are solely determined by the values of their successor states since the advertiser cannot win the current auction V V Computing Optimal Bidding Strategies Computing V with an MDP solver such as value iteration is complicated by the bid space being continuous Computing V for a discretization of this space will require a fine discretization to avoid rounding errors which will mean slow convergence Using numerical optimization methods is complicated by V not being a linear function in bi To avoid these complexities we instead rewrite V in a form that can be solved without any optimization To identify the optimal bidding strategy we observe that the two edge cases do not involve a decision and the strategy of bidding is forced for them We also observe that for the remaining states the valuation function includes many terms that do not change under various bidding strategies We collect these constants into a term which we can ignore while optimizing the strategy We replace i d t i by i the estimated cost of each ad slot The remainder of the valuation function provides the conjoint valuation function a decomposition previously used by Iyer et al Our Lemma in Appendix A shows that V max bi i i i max bi i i i where m i i The conjoint valuation represents the reward for winning both immediate and long-term which is why it is multiplied by the probability of winning i The expected cost of winning i ALGORITHM Iterative approach to find V Input Initialize V m for in do for in m do V max V V end end V V until is subtracted from this product breaks down along the lines of winning and losing cases as N did v i wink lose where wink wink lose The term represents the immediate value of winning the ad slot The reminder considers the gain that the advertiser gets from the future by winning moving to a new state or losing staying put The difference between future rewards for winning and those for losing corresponds to the amount of overbidding or underbidding called for which explains the subtraction in The following theorem shows the use of this decomposition Theorem For all i and states other than the edge cases m and the optimal bid for i subject to K-parity under the distribution at the state is The proof is in Appendix B This theorem means that we do not need to search the space of possible bid values to find the optimal bid Rather we can just compute the optimal bid using While depends upon the value function V we can recursively make use of this fact to compute V without such a search either In particular the theorem implies that V i However this equation is still not a closed-form solution Thus Algorithm does this calculation iteratively to converge to the states values Although showing the convergence in general is an open problem as discussed in Section our experiments find convergence within a reasonable tolerance within a feasible number of iterations To use our approach an advertiser or DSP runs Algorithm to compute the value function V and stores it as a look-up table Then for each new ad auction the advertiser first checks if it winning the auction would violate the parity constraint If so it will not participate in the auction ie bids zero Otherwise The advertiser bids the value of which can be easily computed from value functions RATIO CONSTRAINTS While constraints on the difference between the number of ads shown to each gender are intuitive the EEOCs four-fifths rule found in US regulations against disparate impact in employment instead focuses on a ratio The ratio considered is not simply between the number of ads shown to each gender Rather it acknowledges that parity can be unrealistic due to having differing numbers of male and female applicants It adjusts for that factor by comparing the fraction of female applicants receiving a job offer to the fraction male applicants receiving a job offer It requires that this ratio of ratios be between and We provide a similar constraint that compares two ratios checking whether the fraction of female ad slots won is within a factor of r to the fraction of male ad slots won Strictly enforcing such a check creates problems when the number of slots seen so far is small since the fractions won may be very far apart even when the number of ads shown to each gender only differs by To avoid this issue we also allow an additive difference in the number of ads show to each gender The resulting rule may be viewed as a hybrid between a pure ratio constraint and the absolute constraint we have already presented We use similar notation as in Section to express this constraint in a manner that avoids division by zero Definition r K-ratio An advertiser obeys a r K-strict relative constraint or r K-ratio constraint for short for groups after each auction for all groups and in the number of auctions that it wins satisfies where and are the probability of seeing slots for groups and respectively Modeling Similar to the K-parity constraint we limit ourselves to the case where and only contain two types which we treat as male and female We use p as the probability of a male We denote each state by a triplet n i where n m i and is the current number male and female slots won respectively While we reuse the immediate reward function from we rewrite the value function V and future value function N When winning the slot would not violate the constraint V n i max bi bi i bi n m i n i When offered a male that may not be won because r where is the current number of males won V n i n i n m i n i When a female may not be won since m i V n i n i n m i n i We call these two cases edge cases We set the future value N bi n m i n i at i N win n m i n i i N lose n m i n i with win m i n i n m i n i n m i n i win n m i n m i n m i n i n m i n i N lose n m i n i n m i n i n m i n i ALGORITHM Iterative approach to find V Input r p M Initialize V M r M m V M r M for i in M do for i in r M do for in m do V i n i i n i i i n i n m i n i max V i n i V n m i n i end end end V V until Computing Optimal Bidding Strategies We use a similar approach as in Section to find optimal strategies As before we force the strategy to bid zero when winning would violate the constraint and do not include these cases in the optimization As justified in Appendix C we rewrite the value V n i as max bi i i n m i n i i n m i n i where n m i n i m i i n i n m i n i and n i v i win n m i n i lose n m i n i where win n m i n i n m i n i m n m i n i win m i n i n m i n i n m i n i lose n m i n i n m i n i n m i n i Theorem For all r i and states n i other than the edge cases the optimal bid for i subject to r K-ratio parity under the distribution at the state n i is i n m i n i The proof is similar to that of Theorem This theorem eliminates the need for searching the space of possible bids at each state to find the optimal one Whereas we could bound the state space for K-parity by tracking the difference instead of the actual numbers of male and female ad slots won we cannot similarly bound the state space for the r K-ratio constraint In practice however each advertiser either has a limited budget or is advertising for a limited time allowing us to estimate a finite set of reachable states We to indicate estimated the maximum number of male ad slots won Algorithm computes the value of each state reachable assuming is not surpassed An advertiser using our approach does so in the same manner as with our approach to parity constraints That is it first runs Algorithm and stores V as a look-up table It skips auctions when winning would violate the constraint and otherwise bids computed from V We can extend this approach to recover if the advertiser underestimates M In this case the advertiser can use a linear approximation to estimate the optimal bid To do so let i i M If is an integer value then the advertiser bids Otherwise the advertiser bids EXPERIMENTS We simulate various scenarios to show the feasibility of our method and to measure the impact of our fairness constraints on utility To do so we implemented a second-price auction simulator in Python where each advertiser gets the gender of the website viewer before selecting its bid and participating in the ad slot auction To simulate the viewer we draw their genders independent and identically from a binomial distribution with probability p where p is the probability of the viewer be male We focus on one advertiser i and measure how its utility changes when it has either a fairness constraint or not When having a fairness constraint it uses our bidding strategy with set to unless otherwise noted and set to When not it bids its immediate value for the ad slot t as is rational for an unconstrained second-price auction We assume that the other advertisers are unconstrained and they always bid their immediate values To obtain distributions over ad values we used both a real dataset the Yahoo A Search Marketing Advertiser Bidding Dataset and a simulated one Since the Yahoo A data does not have exact timestamps we could not use it to estimate the number of advertisers ie for each ad auction To estimate we visited top websites according to that have ads using header bidding For one month June we collected how many advertisers bid on a specific ad slot In our observations of these sites we never saw more than advertisers bid on an ad slot In line with this observation we assume that there are advertisers bidding for each ad slot Real Dataset The Yahoo A Search Marketing Advertiser Bidding Dataset contains anonymized bids of advertisers participating in Yahoo Search Marketing auctions for the top search queries from June to June The dataset includes millions bids from more than advertisers but without the exact timestamps or information about the ad viewer Each record in this dataset indicates a course timestamp with minutes precision the advertiser the keyword and the bid In our analysis we assumed bids have a stationary distribution We evaluate this assumption on our dataset We use a specific keyword keyword number and we gathered all of bids from different advertisers in four days period starting Then we compute the empirical distribution of the bids of the first two days and the second two days Figure presents the distribution of the bids for these periods showing that the distributions are very similar in both periods supporting our stationarity assumption The figure also shows that the bids follow a log-normal distribution in line with the findings of Balseiro et al Bid ra io n Lognorm First two days Last two days Figure Distribution of the bids for two different periods The distributions are similar in both periods which supports the assumption that bids distribution are stationary We enforce a separate parity constraint on each keyword in the dataset to ensure that they each get roughly equal numbers of male and female viewers Each keyword has a different bid value distribution and we have our simulated constrained advertiser model each keyword with a separate MDP to compute the optimal bidding strategy for each We assume that the constrained advertiser updates its model parameters every two days As mentioned the Yahoo A dataset does not contain the exact timestamps Therefore we cannot exactly determine which advertisers participated in any single ad auction We randomly select a set of advertisers bids from each -minute interval for each of our ad auctions Since the dataset does not include information about the viewers we sample the bids for both female and male viewers from the same set of bid values making their values equal Figures a b and c show the total utility ratio of the K-parity and r K-ratio versions to the unconstrained version of the advertiser i for various values of r and p on Yahoo A bid dataset Here and in the other simulations we compute this ratio by simulating constrained and unconstrained versions of the advertiser i using the same draw of values across the two versions We do this times computing the average of total utilities for each version We then plot the ratio of these two averages Since the value of ad slots for both female and male viewers are equal the total utility of an unconstrained advertiser will not change for different values of p On the other hand a constrained advertiser will get different utilities based on the distribution of the men and women viewers K-parity and r K-ratio constraints are harder to achieve for extreme values of p Turning to the effects of the results show that when is large the K-parity advertiser can reach the utility of the unconstrained advertiser Also by relaxing r r K-ratio advertiser achieves higher utility To show the benefit of our approach compared to simply bidding immediate values we compare the utility ratio across both approaches Figures d and e show that our bidding strategy allows the advertiser to achieve a higher utility ratio We note that Table Parameters for the log-normal distribution used in the modeling the bids in the ad slot auctions is always Scenario name Others Advertiser i i i Equal price Female valuable Expensive female Equal value the difference in these utility ratios is muted by assuming that each gender is equally valuable to the advertiser This assumption comes from the real dataset not showing which ad slots are for men and which are for women We avoid this limitation when we use our synthetic data Synthetic Data We use a synthetic dataset to explore how changing their relative values of men and women affects the advertisers utility We generate two synthetic datasets using a log-normal distribution to sample the advertisers bids Table shows the model parameter settings used for the two scenarios To show the effect of assigning different values to men and women consider an advertiser that gives more value to female slots than to male ones as shown in the Equal price Female valuable scenario Figure a shows the utility ratio for the K-parity and unconstrained versions of the advertiser in this scenario The K-parity version has its maximum utility ratio when there are more male than female slots This may seem counterintuitive since the advertiser values females more but the measured ratio reflects that an abundance of males means that the K-parity version will not have to operate much differently from the unconstrained one This is due to their abundance making overbidding less needed decreasing the K-parity versions costs Figures b and c show similar results for the r K-ratio constraint Lambrecht et al empirically showed that ad slots for young women are more expensive To simulate this setting we considered a scenario in which the other advertisers prefer females ie x x for all i and x We used the Expensive female Equal value parameter settings for this scenario We have advertiser i value both types equally at the average of the two different values used by the other advertisers Figure d plots the total utility ratio as before solid line Note that as women become rare the K-parity version struggles relative to the unconstrained one since the other advertisers snap up the few women leaving the constrained version unable to bid for men The figure also shows the total utility ratio for a constrained version of the advertiser i that uses the same simple bidding strategy as the unconstrained advertisers dashed line Note that ratio is lower than with our optimal bidding strategy showing its value This difference comes from our optimal bidding strategy overbidding for the female viewers delaying the aforementioned effect Figure e shows that under the ratio constraint which is less strict the optimal strategy can do even better Figures and g further explore overbidding using a variation on the Expensive female Equal value scenario Rather than keep the p T ot al U ti lit y R at io a Cost of K-parity p T ot al U ti lit y R at io r r r b Cost of ratio p T ot al U ti lit y R at io c Cost of K-ratio p ratio T ot al U ti lit y R at io K-parity Optimal K-parity Simple d Costs for parity for the optimal strategy and for simple immediate value p T ot al U ti lit y R at io r K-ratio Optimal r K-ratio Simple e Costs for ratio for the optimal strategy and for simple immediate value Figure Experimental results for Yahoo A bidding dataset value that the advertiser i assigns to males fixed at we vary it to see the effect on overbidding Rather than plot itself we plot the ratio of to the value assigned to males by the other advertisers Figure shows this value ratio by using various lines Overbidding is not needed when the ratio is since the advertiser i can outbid the other advertisers without surpassing its immediate reward For ratios above as the rate p of male viewers increases the optimal K-parity advertiser will increase its overbidding on the female viewers since they become more scarce Figure g shows that as and thus the male value ratio of advertiser i to the other advertisers increases the overbidding for females increases Figure plots the utility ratio as the value of the rate at which the advertiser i will leave the ad network changes Rather than plot directly it plots the expected lifespan of the advertiser computed from It shows that for short lived advertisers K-parity has no effect since the advertiser is unlikely to reach wins for either gender However the constraint rapidly has an effect as the advertiser lives long enough to win this number of slots Ad Exchange Revenue Also important is how our strategy impacts the revenue of the ad exchange We explored the ratio of the ad exchanges revenue when there is one constrained advertisers for each ad slot auction to the case where all advertisers are unconstrained for all of our scenarios for both the real and synthetic datasets In most cases the ad exchange revenue did not decrease at all The worst case happens for a ratio constrained advertiser on the Yahoo A data where the ratio of revenues is The ad exchange can avoid this worst case by having lower bounds on and r Therefore implementing this feature will not significantly reduce the ad exchanges revenue In fact supporting constraints may raise the ad exchanges revenues Our observations show constrained advertisers often overbid which increases the exchanges revenue Figure compares the revenue of the exchange for various numbers of constrained advertisers using the Yahoo A dataset As expected by increasing the number of constrained advertisers the the revenue of ad exchanges increases above a ratio of with the revenue from having only unconstrained advertisers Performance Algorithms and each of which only has to run once for each parameter setting completed in under minutes and under minutes respectively Calculating bids during auctions each took the microseconds We used a MacBook Pro with a GHz Intel Core i and GB of memory DEPLOYMENT We envision two ways in which advertisers could use our bidding strategy First ad exchanges can implement it for them as a feature in the ad buying interface Such exchanges could use the data it has to determine the demographics of individuals viewing ad slots and adjust bids accordingly While this would require a change to the ad exchange it would not require modifying the core auction mechanism making it a more straightforward feature to add p T ot al U ti lit y R at io a Cost of K-parity for Equal price Female valuable scenario p T ot al U ti lit y R at io r r r b Cost of ratio for Equal price Female valuable scenario p T ot al U ti lit y R at io c Cost of K-ratio for Equal price Female valuable scenario p T ot al U ti lit y R at io K-parity Optimal K-parity Simple d Costs for parity for the optimal strategy and for simple immediate value bidding for Expensive female Equal value scenario p T ot al U ti lit y R at io r K-ratio Optimal r K-ratio Simple e Costs for ratio for the optimal strategy and for simple immediate value bidding for Expensive female Equal value scenario Probability of male viewer p O ve rb id r fe m al e vi er Ratio Ratio Ratio Average amount of overbidding for the female viewers for values of p Ratio of avg men value to avg men price O ve rb id r fe m al e vi er g Average overbidding for female viewers for ratios of average male viewer value to price of male viewers with p Expected lifespan T ot al U ti lit y R at io Cost of parity for values of as the expected lifespan of the advertiser in the Expensive female Equal value scenario Figure Experimental results for synthetic datasets Second the strategy could be used either directly by the advertiser or offered to them by demand-side platforms as a feature This approach does not require any changes to the ad exchange It has the disadvantage of only working for ad exchanges that support real-time bidding and programmatic advertising with rich enough data to infer the group membership of the people viewing ad slots Additionally such rich data can pose privacy concerns We believe that either of these approaches to deployment would be more straightforward than any way of deploying an auction mechanism that enforces parity constraints or Guaranteed ad Delivery GD Only the ad exchange would be able to implement such functionality Presumably ad exchanges have already selected the auction mechanism that they believe would be best for their business and would be reluctant to change it in a way that could have wide-ranging effects Given that Google uses a generalization of second-price auctions it may believe that the theoretical result that second-price auctions are optimal in certain settings has some bearing on its setting Thus it may believe that p T ot al R en R at io Figure Ratio of the ad revenue with constrained advertisers and without for various numbers of advertisers subject to a ratio constraint computed with the Yahoo A dataset any change to its auction mechanism is likely to reduce its profits a strong disincentive We believe that ad exchanges would be more willing to implement a change that instead only alters the bids of advertisers who opt in since it would be equivalent to one that advertisers could already implement unilaterally by altering their bids Furthermore since our approach changes just opted-in advertisers bids there is a sense in which they pay for it We believe that our approach is computationally feasible In some cases an advertiser may have to solve more than one MDP For example the advertiser may wish to enforce a separate parity constraint for two different webpages whose ad slots differ in characteristics included in the MDP The advertiser will have to solve an MDP for each ad campaign targeting a different type of ad auction with its own expected values bid distributions and parity constraints Given modern approaches to solving large MDPs and the ability to rent cloud computing resources we believe that advertisers sophisticated enough to model a large number of different auction types will be able to solve them as well Once solved the advertiser can reuse the solution for every instance of the auction type Thus addressing each incoming bid request from the ad exchange takes little more than a table lookup EXTENSIONS AND FUTURE WORK Our model of ad exchanges does not include that advertisers often pay exchanges more when the viewer clicks on an ad Thus the expected value vi and cost of a slot depends upon not just the bid prices but also the fit of the ad for the slot which can be estimated with online tracking and machine learning It may seem that these changes will have to be linked since a clicked ad both increases the value and cost but by the linearity of expectations we can consider the average of each This changes the reward on the transitions in the MDP but not structure of the MDP the state space and the transition relation Therefore an advertiser can still use our approach to find optimal bids We used a simple model in which the expected value of each female slot is equal to the others and the expected value of each male slot is equal to the others Advertisers can use online tracking machine learning and other techniques to compute more fine-grained estimations of slot values We can accommodate such fine-grained modeling by increasing the size of the set of types which will increase the size of state space Future work could accommodate constraints for non-binary sensitive attributes such as age and location a proxy for race which is apparently not explicitly tracked by any ad exchange leading to a larger set of protected groups Multiple simultaneous constraints can lead to having multiple Although our MDPs can be extended to such cases using a cross-product-like construction the MDP size will be exponential in the number of constraints and their values motivating more significant theoretical future work Nevertheless we suspect that the limited number of protected attributes tracked by ad exchanges fast MDP solvers and cloud computing will make our approach fast enough in practice The constraints we explore are very strict in that they must hold at all times as opposed to holding with high probability or asymptotically which might be acceptable in some settings In related problems parity may only be required at the end of certain checkpoints such as at the end of a hiring season Exploring such relaxations can be future work Our work is an example of the tension between not using protected attributes and avoiding disparity in outcomes Our ratio constraint avoids disparity in outcomes and is based on the four-fifths rule found in US antidiscrimination rules around disparate impact However that rule is with respect to employment practices that are on their face neutral toward protected groups Our constraints explicitly use protected attributes to enforce strict quotas In some cases Quotas are expressly forbidden by US regulations Resolving this tension between competing antidiscrimination goals is tricky see eg An analysis of when our approach would be legal would be context and country specific and beyond the scope of this work However we will mention that in some cases US antidiscrimination laws would not apply such as to private clubs In such cases the advertiser may be guided by its ethics to use our approach to avoid disparity in outcomes CONCLUSION Adding parity constraints results in a surprisingly complex bidding problem exhibiting both over- and underbidding relative to the advertisers immediate value of an ad slot Despite this complexity we show a practical way of computing optimal bids to within a small approximation factor This enables us to characterize how the cost of parity depends upon not just its level of strictness or r but also the base rate p of types their relative values to both the governed advertiser i and to other advertisers and the lifespan or discounting factor in sometimes counterintuitive ways